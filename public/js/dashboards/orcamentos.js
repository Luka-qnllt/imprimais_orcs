(()=>{var t={581:t=>{var a={status:{1:"Entregue",2:"Concluído",3:"Em Andamento",4:"Aguardando Aprovação",5:"Não Iniciado"},prior:{1:"Alta",2:"Média",3:"Baixa"},serializeObject:function(t){var a={},e=t.serializeArray();return $.each(e,(function(){a[this.name]?(a[this.name].push||(a[this.name]=[a[this.name]]),a[this.name].push(this.value||"")):this.name.match("]")?(a[this.name]=[],a[this.name].push(this.value||"")):a[this.name]=this.value||""})),a},setError:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Swal.fire({type:"error",title:t.msg,html:t.body?t.body:""})},load:{start:function(){$(".pace").css("z-index","15000"),$(".pace").removeClass("pace-inactive"),$(".pace").addClass("pace-active")},stop:function(){$(".pace").removeClass("pace-active"),$(".pace").addClass("pace-inactive")}},success:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Swal.fire({type:"success",title:t.title,html:"<p>"+(t.msg?t.msg:"")+"</p>",timer:1e3,showConfirmButton:!1,didOpen:function(){Swal.showLoading(),timerInterval=setInterval((function(){var t=Swal.getContent();if(t){var a=t.querySelector("b");a&&(a.textContent=Swal.getTimerLeft())}}),100)},willClose:function(){clearInterval(timerInterval)}})},toMoney:function(t){if(null==t||""==t)return"0,00";if(parseFloat(t)>0){var a=parseFloat(t).toFixed(2),e=parseFloat(a).toLocaleString("pt-BR",{currency:"BRL"}).split(","),n=e[1]?e[1].padEnd(2,"0"):"00";return e[0]+","+n}return"0,00"},formartDate:function(t){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null==t)return"-";var e=t.match("T")?t.split("T"):t.split(" "),n=e[0].split("-"),o=n[2],r=n[1],i=n[0];return o+"/"+r+"/"+i+(e[1]&&a?" "+e[1]:"")},confirm:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Swal.fire({type:"warning",title:t.title,html:"<p>"+(t.msg?t.msg:"")+"</p>",showCancelButton:!0,confirmButtonText:t.textBtnConfirm||"OK",cancelButtonText:t.textBtnCancel||"Cancelar"}).then((function(a){a.value?t.onConfirm&&t.onConfirm():t.onCancel&&t.onCancel()}))},unMaskMoney:function(t){return t=t.replaceAll(".","").replaceAll(",",".").replaceAll(" ","").replace("R$",""),t=parseFloat(t),!isNaN(t)&&t}};t.exports=a}},a={};function e(n){var o=a[n];if(void 0!==o)return o.exports;var r=a[n]={exports:{}};return t[n](r,r.exports,e),r.exports}(()=>{function t(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var o=0,r=function(){};return{s:r,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,l=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return l=t.done,t},e:function(t){s=!0,i=t},f:function(){try{l||null==n.return||n.return()}finally{if(s)throw i}}}}function a(t,a){(null==a||a>t.length)&&(a=t.length);for(var e=0,n=new Array(a);e<a;e++)n[e]=t[e];return n}var n=e(581),o={bindEvents:function(){$("#open-modal-orc").on("click",(function(){o.resetForm(),$("#modal-orc").modal("show")})),$("#btn-add-item").on("click",(function(){var t={titulo:$("#new-item-item").val(),qtd:$("#new-item-qtd").val(),valor_un:$("#new-item-valor-un").val()};""!=t.titulo&&null!=t.titulo&&o.addItem(t)})),$("#itens-wrap").on("click",".btn-remove-item",o.removeItem),$("#form-orc").on("submit",(function(t){t.preventDefault();var a=$(this).find("[name=id]").val();null==a||""==a?o.create():o.update(a)})),$("#orcs-wrap").on("click",".btn-edit",(function(){o.get($(this).data("id"))})),$("#orcs-wrap").on("click",".btn-delete",(function(){var t=$(this).data("id");n.confirm({title:"Deseja deletar este registro?",confirmButtonText:"Sim, deletar",onConfirm:function(){o.delete(t)}})})),$("#btn-search").on("click",o.list),$("#btn-clean-seach").on("click",(function(){$("#search-inicio").val(""),$("#search-status").val(""),$("#search-pagamento").val("PD"),$("#search-prioridade").val("")})),$("#send-mail").on("click",o.setValuesMail),$("#form-mail").on("submit",o.sendMail),$(".modal").on("hidden.bs.modal",(function(){$(".modal").css("orverflow","auto")}))},resetForm:function(){$("#form-orc").trigger("reset"),$("#form-orc").find("[name=id]").val(""),$("#itens-wrap").html(""),$("#form-pdf").css("display","none"),$("#send-mail").css("display","none")},addItem:function(t){var a=o.geraIndex(),e=null==t.id||""==t.id?n.unMaskMoney(t.valor_un):t.valor_un,r=isNaN(e*parseFloat(t.qtd))?0:e*parseFloat(t.qtd),i='\n            <tr class="item item-added" id="item-'.concat(a,"\">\n                <input type=\"hidden\" name='item_id[]' value='").concat(t.id||"",'\'>\n                <td class="p-0 index-item">#</td>\n                <td class="p-0"><input type="text" class="form-control border-0" name=\'item_titulo[]\' value=\'').concat(t.titulo,"'></td>\n                <td class=\"p-0\"><input type=\"number\" min='0' class=\"form-control border-0\" name='item_qtd[]' value='").concat(t.qtd||0,'\'></td>\n                <td class="p-0"><input type="text" class="form-control border-0 money" name=\'item_valor_un[]\' value=\'').concat(n.toMoney(e),'\'></td>\n                <td class="p-0 total-item" data-valor="').concat(r,'">').concat(n.toMoney(r),'</td>\n                <td class="p-0"><i class="fa fa-times text-danger hover btn-remove-item" data-id="').concat(t.id||"",'" data-index="').concat(a,'"></i></td>\n            </tr>');$("#itens-wrap").append(i),o.atualizaIndexItem(),o.atualizeTotalItens(),$(".item-reset").val(""),$(".money").maskMoney({decimal:",",thousands:"."})},atualizeTotalItens:function(){var t=0;$(".total-item").each((function(a,e){t+=parseFloat($(e).data("valor"))})),$("#total-itens").html(n.toMoney(t)),$("#form-orc").find("[name=valor_total]").val(n.toMoney(t))},atualizaIndexItem:function(){$(".index-item").each((function(t,a){$(a).html(t+1)}))},geraIndex:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return t+=$(".item").length,$("#item-".concat(t)).length>0?o.geraIndex(t):t},create:function(){n.load.start(),$.ajax({url:"/orcamentos/ajax/save",type:"post",dataType:"json",data:n.serializeObject($("#form-orc")),success:function(t){n.load.stop(),t.status&&(o.get(t.data.id),o.list(),n.success({title:"Salvo!"}))},error:function(t){n.load.stop(),console.error(t)}})},update:function(t){n.load.start(),$.ajax({url:"/orcamentos/ajax/update/"+t,type:"post",dataType:"json",data:n.serializeObject($("#form-orc")),success:function(a){n.load.stop(),a.status&&(o.get(t),o.list(),n.success({title:"Salvo!"}))},error:function(t){n.load.stop(),console.error(t)}})},list:function(){n.load.start(),$.ajax({url:"/orcamentos/ajax/list",type:"post",dataType:"json",data:{inicio:$("#search-inicio").val(),status:$("#search-status").val(),pagamento:$("#search-pagamento").val(),prioridade:$("#search-prioridade").val()},success:function(a){n.load.stop();var e,o=$(".page-item.active a").data("dt-idx")?$(".page-item.active a").data("dt-idx"):1,r={receber:0,recebido:0,pendentes:0},i="",l=t(a.data);try{for(l.s();!(e=l.n()).done;){var s=e.value,c="";"PG"==s.pagamento?c="success":1==s.prioridade&&s.status>2?c="warning":1==s.status&&"PD"==s.pagamento&&(c="danger"),"PG"==s.pagamento&&(r.recebido+=parseFloat(s.valor_total)),s.status>2&&r.pendentes++,1==s.status&&"PD"==s.pagamento&&(r.receber+=parseFloat(s.valor_total)),i+='\n                            <tr class="hover btn-edit '.concat(c,'" data-id="').concat(s.id,'">\n                                <td>').concat(s.nota_fiscal||"-","</td>\n                                <td>").concat(s.pedido||"-","</td>\n                                <td>").concat(s.solicitante||"-","</td>\n                                <td>").concat(n.formartDate(s.inicio)||"-","</td>\n                                <td>").concat(n.status[s.status]||"-","</td>\n                                <td>").concat(n.toMoney(s.valor_total)||"-",'</td>\n                                <td>\n                                    <button class="btn btn-sm btn-outline-danger flot-right btn-delete" data-id="').concat(s.id,'"><i class="fa fa-trash"></i></button>\n                                </td>\n                            </tr>')}}catch(t){l.e(t)}finally{l.f()}$("#table-orc").DataTable().destroy(),$("#orcs-wrap").html(i);$("#table-orc").DataTable({language:{url:"//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Portuguese-Brasil.json"},pageLength:50});console.log("currentPage ",o),setTimeout((function(){$(".page-item a[data-dt-idx=".concat(o,"]")).click()}),100),$("#receber").html(n.toMoney(r.receber)),$("#recebido").html(n.toMoney(r.recebido)),$("#pendentes").html(r.pendentes)},error:function(t){n.load.stop(),console.error(t)}})},get:function(t){n.load.start(),$.ajax({url:"/orcamentos/ajax/get/"+t,type:"post",dataType:"json",success:function(t){n.load.stop(),$("#itens-wrap").html(""),o.setValueOrc(t.data)},error:function(t){n.load.stop(),console.error(t)}})},setValueOrc:function(a){console.log(a);var e=$("#form-orc");for(var r in a){var i=e.find("[name=".concat(r,"]"));i.is(".money")?i.val(n.toMoney(a[r])):i.val(a[r]||"")}var l,s=t(a.itens);try{for(s.s();!(l=s.n()).done;){var c=l.value,d={id:c.id,titulo:c.titulo,qtd:c.qtd,valor_un:c.valor_un};o.addItem(d)}}catch(t){s.e(t)}finally{s.f()}$("#form-pdf").attr("action","/orcamentos/pdf-orcamento/"+a.id),$("#form-pdf").css("display","initial"),$("#send-mail").css("display","initial"),$("#modal-orc").modal("show")},delete:function(t){n.load.start(),$.ajax({url:"/orcamentos/ajax/delete/"+t,type:"post",dataType:"json",success:function(t){n.load.stop(),o.resetForm(),o.list(),$("#modal-orc").modal("hide"),n.success({msg:"Deletado"})},error:function(t){n.load.stop(),console.error(t)}})},removeItem:function(){var t=$(this).data("index"),a=$(this).data("id");null!=a&&""!=a?(n.load.start(),$.ajax({url:"/orcamentos/ajax/delete-item/"+a,type:"post",dataType:"json",success:function(a){n.load.stop(),$("tr#item-".concat(t)).remove(),o.atualizaIndexItem(),o.atualizeTotalItens()},error:function(t){n.load.stop(),console.error(t)}})):($("tr#item-".concat(t)).remove(),o.atualizaIndexItem(),o.atualizeTotalItens())},setValuesMail:function(){var t=$("#form-orc"),a=$("#form-mail"),e=t.find("[name=id]").val(),n=t.find("[name=email]").val().toLowerCase();a.find("[name=email]").val(n),a.find("[name=id_orc]").val(e),$("#modal-mail").modal("show")},sendMail:function(t){t.preventDefault();var a=$("#form-mail"),e=a.find("[name=id_orc]").val();n.load.start(),$.ajax({url:"/orcamentos/ajax/send-mail/"+e,type:"post",dataType:"json",data:{email:a.find("[name=email]").val(),message:a.find("[name=message]").val()},success:function(t){n.load.stop(),t.status?(a.find("[name=email]").val(""),a.find("[name=message]").val(""),a.find("[name=id_orc]").val(""),$("#modal-mail").modal("hide"),n.success({title:"Email enviado com sucesso!"})):n.setError({msg:t.msg||"Falha ao enviar email"})},error:function(t){n.load.stop(),n.setError({msg:t.responseText}),console.error(t)}})}};$(document).ready((function(){o.bindEvents(),o.list(),$(".money").maskMoney({decimal:",",thousands:"."}),$(".modal").css("orverflow","auto")}))})()})();